app: me.santamorena.drill
ingredients:
  dist: trusty
  sources:
    - deb http://deb.debian.org/debian stretch main
  packages:
    - tcl=8.6.0+9
    - python3-minimal
    - python3-tk
    - python3-psutil
    

    # - libtinfo
    # - build-essential
    # - language-pack-en
    # - gcc
    # - cython3
    # - python3.4
    # - gcc
    # - cython
  #   - language-pack-en
  #   - python3-tk==8.6.6
  #   - python3-psutil==5.6.2
  # script:
  #   - wget -c https://github.com/yatima1460/drill/archive/master.zip
  #   - unzip -o master.zip
  # script:
  #   - locale-gen en_US.UTF-8

  # script:
    # - echo "Started building process..."
    # - cython --embed -3 drill.py
    # - gcc -O0 drill.c -I/usr/include/python3.5m -lpython3.5m -o drill.bin
    # - chmod +x drill.bin
    # - echo "Started building process... DONE"
  script:
    #- echo "Current folder: $PWD"

    - mkdir -p me.santamorena.drill.AppDir/usr
    - cp ../drill.py me.santamorena.drill.AppDir/usr
    - cp ../icon.png me.santamorena.drill.AppDir/usr
    - cp -r ../blocklists me.santamorena.drill.AppDir/usr
    - cp ../icon.png me.santamorena.drill.AppDir
    - mkdir -p ./usr/share/icons/hicolor/256x256/
    - cp ../icon.png ./usr/share/icons/hicolor/256x256/
    #- mv drill.bin me.santamorena.drill.AppDir/usr

    # - mkdir -p usr/share/metainfo/ ; cp ../mu.appdata.xml usr/share/metainfo/
    #- virtualenv --python=python3 usr
    #- source usr/bin/activate

    #- pip3 install -e .
    #- deactivate


    - cat > me.santamorena.drill.AppDir/usr/drill.sh <<\EOF
    - #!/bin/bash
    # - export PYTHONHOME=/usr/bin/
    # - export PYTHONPATH=/usr/bin/
    # - locale-gen en_US.UTF-8
    - python3 drill.py
    - EOF
    - chmod +x me.santamorena.drill.AppDir/usr/drill.sh

    # - cat > me.santamorena.drill.AppDir/drill.sh <<\EOF
    # - #!/bin/bash
    # - ./usr/drill.bin
    # - EOF
    # - chmod +x me.santamorena.drill.AppDir/drill.sh

    - mkdir -p usr/share/applications
    - cat > usr/share/applications/me.santamorena.drill.desktop <<\EOF
    - [Desktop Entry]
    - Type=Application
    - Name=Drill
    - Comment=Search files without using indexing, but clever crawling
    - Comment[it]=Trova files sul tuo PC senza indicizzare, ma cercando intelligentemente
    - Icon=icon
    - Exec=sh drill.sh
    - Terminal=false
    - Categories=Application;Utility;
    - Keywords=Search;FileSearch;File Search;Find;
    # - StartupWMClass=mu
    - MimeType=text/x-python3;text/x-python3;
    - EOF
    - cp usr/share/applications/me.santamorena.drill.desktop .
    - cp me.santamorena.drill.desktop me.santamorena.drill.AppDir
    - cp ../icon.png me.santamorena.drill.AppDir
    # - usr/bin/pip3 freeze | grep "mu-editor" | cut -d "=" -f 3 >> ../VERSION